#!/usr/bin/env python

# Filter fasta file by some arbitrary parameter.

import argparse
from Bio import SeqIO
import re

def parse_args():
    parser = argparse.ArgumentParser()

    parser.add_argument('--fasta-file', default='/dev/stdin')
    parser.add_argument('--output', default='/dev/stdout')
    parser.add_argument('--param', default=True, type=str)
    parser.add_argument('--skip-fail', help='do not print record if an exception is raised', default=False, action='store_true')

    return parser.parse_args()


def main():

    args = parse_args()

    with open(args.fasta_file) as handle:
        records = SeqIO.parse(handle, 'fasta')

        out_handle = open(args.output, 'w')

        for r in records:
            print_record = False

            try:
                print_record = eval(args.param)
            except Exception as e:
                if args.skip_fail:
                    continue
                else:
                    raise e

            if print_record:
                print >> out_handle, r.format('fasta')

        out_handle.close()



if __name__ == '__main__':
    main()
